<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/image/ukraine.png" rel="icon">
    <title>ITUA</title>
    <!-- Import Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
    <link href="/styles.css" rel="stylesheet" />
</head>
<body>
<div class="container home-container">
    <div class="lang-switcher">
        <button type="button" class="lang-btn" id="lang-en">EN</button>
        <button type="button" class="lang-btn" id="lang-uk">UA</button>
    </div>
    <div class="header">
        <div class="logo-row">
            <img src="/image/logo.png" alt="logo" class="header-logo">
            <img src="/image/artline_logo.png" alt="artline-logo" class="header-logo header-logo-artline">
        </div>
        <h1 id="title">Main Menu</h1>
    </div>
    <div class="content">
        <ul class="menu">
            <li><a href="/status.php" id="link-status">Status</a></li>
            <li><a href="/tools_list.php" id="link-tools">Tools</a></li>
            <li><a href="/settings.php" id="link-settings">Settings</a></li>
        </ul>
    </div>
</div>
<script>
    const translations = {
        en: {
            title: "Main Menu",
            status: "Status",
            tools: "Tools",
            settings: "Settings",
            versionLabel: "Version",
            githubLabel: "GitHub",
            updateAvailable: "Update available",
            upToDate: "Up to date",
            updateNow: "Update",
            footerSlogan: "Together to freedom"
        },
        uk: {
            title: "Головне меню",
            status: "Статус",
            tools: "Інструменти",
            settings: "Налаштування",
            versionLabel: "Версія",
            githubLabel: "GitHub",
            updateAvailable: "Доступне оновлення",
            upToDate: "Актуальна",
            updateNow: "Оновити",
            footerSlogan: "Разом до свободи"
        }    };

    const langEnBtn = document.getElementById("lang-en");
    const langUkBtn = document.getElementById("lang-uk");
    const titleEl = document.getElementById("title");
    const statusEl = document.getElementById("link-status");
    const toolsEl = document.getElementById("link-tools");
    const settingsEl = document.getElementById("link-settings");
    let activeLang = "en";
    let versionInfo = { current: "...", github: "..." };

    function getCookie(name) {
        const parts = document.cookie.split("; ").find((row) => row.startsWith(name + "="));
        return parts ? decodeURIComponent(parts.split("=")[1]) : null;
    }

    function updateLinks(lang) {
        statusEl.href = "/status.php?lang=" + encodeURIComponent(lang);
        toolsEl.href = "/tools_list.php?lang=" + encodeURIComponent(lang);
        settingsEl.href = "/settings.php?lang=" + encodeURIComponent(lang);
        const footerUpdateActionEl = document.getElementById("footer-update-action");
        if (footerUpdateActionEl) {
            footerUpdateActionEl.href = "/settings.php?lang=" + encodeURIComponent(lang);
        }
    }

    function applyLang(lang) {
        activeLang = (lang === "uk" || lang === "en") ? lang : "en";
        const text = translations[activeLang];
        titleEl.textContent = text.title;
        statusEl.textContent = text.status;
        toolsEl.textContent = text.tools;
        settingsEl.textContent = text.settings;
        const footerSloganEl = document.getElementById("footer-slogan");
        if (footerSloganEl) {
            footerSloganEl.textContent = text.footerSlogan;
        }
        const footerVersionCurrentLabelEl = document.getElementById("footer-version-current-label");
        const footerVersionGithubLabelEl = document.getElementById("footer-version-github-label");
        const footerVersionCurrentEl = document.getElementById("footer-version-current");
        const footerVersionGithubEl = document.getElementById("footer-version-github");
        const footerUpdateStateEl = document.getElementById("footer-update-state");
        const footerUpdateActionEl = document.getElementById("footer-update-action");
        if (footerVersionCurrentLabelEl) footerVersionCurrentLabelEl.textContent = text.versionLabel;
        if (footerVersionGithubLabelEl) footerVersionGithubLabelEl.textContent = text.githubLabel;
        if (footerVersionCurrentEl) footerVersionCurrentEl.textContent = versionInfo.current;
        if (footerVersionGithubEl) footerVersionGithubEl.textContent = versionInfo.github;
        const haveBoth = versionInfo.current !== "unknown" && versionInfo.github !== "unknown" && versionInfo.current !== "..." && versionInfo.github !== "...";
        const updateNeeded = haveBoth && versionInfo.current !== versionInfo.github;
        if (footerUpdateStateEl) {
            footerUpdateStateEl.textContent = updateNeeded ? text.updateAvailable : text.upToDate;
            footerUpdateStateEl.classList.toggle("update-needed", updateNeeded);
            footerUpdateStateEl.classList.toggle("up-to-date", !updateNeeded);
        }
        if (footerUpdateActionEl) {
            footerUpdateActionEl.textContent = text.updateNow;
            footerUpdateActionEl.classList.toggle("visible", updateNeeded);
        }
        langEnBtn.classList.toggle("active", activeLang === "en");
        langUkBtn.classList.toggle("active", activeLang === "uk");
        updateLinks(activeLang);
    }

    async function fetchVersionInfo() {
        try {
            const response = await fetch("/version_info.php", { cache: "no-store" });
            const data = await response.json();
            if (!data || data.ok !== true) {
                return;
            }
            versionInfo = {
                current: data.current || "unknown",
                github: data.github || "unknown"
            };
            applyLang(activeLang);
        } catch (e) {
        }
    }

    async function refreshMainStatusIndicator() {
        try {
            const response = await fetch("/status.php?ajax=1&lang=" + encodeURIComponent(activeLang), { cache: "no-store" });
            const data = await response.json();
            const isActive = !!(data && data.ok === true && data.activeModule);
            statusEl.classList.toggle("main-status-active", isActive);
        } catch (e) {
            statusEl.classList.remove("main-status-active");
        }
    }

    function setLang(lang) {
        document.cookie = "lang=" + encodeURIComponent(lang) + "; path=/; max-age=31536000";
        applyLang(lang);
    }

    const params = new URLSearchParams(window.location.search);
    const initialLang = params.get("lang") || getCookie("lang") || "en";
    applyLang(initialLang);
    fetchVersionInfo();
    refreshMainStatusIndicator();
    setInterval(refreshMainStatusIndicator, 5000);

    langEnBtn.addEventListener("click", () => setLang("en"));
    langUkBtn.addEventListener("click", () => setLang("uk"));
</script>
<footer class="app-footer">
    <div>&copy; 2022-<span id="copyright-year"></span> IT Army of Ukraine. <span id="footer-slogan">Together to freedom</span>.</div>
    <div class="footer-version"><span id="footer-version-current-label">Version</span>: <span id="footer-version-current">...</span> | <span id="footer-version-github-label">GitHub</span>: <span id="footer-version-github">...</span></div>
    <div class="footer-update-row"><span id="footer-update-state" class="footer-update-state up-to-date">Up to date</span> <a id="footer-update-action" class="footer-update-action" href="/settings.php">Update</a></div>
</footer>
<script>
    document.getElementById("copyright-year").textContent = String(new Date().getFullYear());
</script>
</body>
</html>

